"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("vue"),a={name:"CustomWaveForm",props:{updateIsplaying:{type:Function,required:!1},audioUrl:{type:String,required:!0},showPlayButton:{type:Boolean,default:!0},waveColor:{type:String,default:"#4F4A85"},progressColor:{type:String,default:"#383351"}},setup(a){const l=e.ref(null),o=e.ref(null),t=e.ref(null),n=e.ref(!1),r=e.ref(0),i=e.ref(0),c=e.ref(0),u=e.ref([]),s=e.ref(0),d=e.ref(0),v=e.ref(null),m=e.ref(0),f=e.ref(null),p=async()=>{try{l.value=new(window.AudioContext||window.webkitAudioContext);const e=await fetch(a.audioUrl),t=await e.arrayBuffer();o.value=await l.value.decodeAudioData(t),c.value=o.value.duration,await g()}catch(e){console.error("Error initializing audio:",e)}},g=async()=>{const e=o.value.getChannelData(0),a=Math.floor(e.length/1e3);u.value=[];for(let l=0;l<1e3;l++){const o=a*l;let t=0;for(let l=0;l<a;l++){const a=Math.abs(e[o+l]);a>t&&(t=a)}u.value.push(t)}h()},y=()=>{const e=f.value,a=e.parentElement;s.value=a.clientWidth,d.value=a.clientHeight,e.width=s.value,e.height=d.value,h()},h=()=>{if(!u.value.length||!f.value)return;const e=f.value,l=e.getContext("2d"),o=e.width,t=e.height;l.clearRect(0,0,o,t);const n=o/u.value.length,r=.2;if(l.fillStyle=a.waveColor,u.value.forEach(((e,a)=>{const o=a*n,i=e*t;l.fillRect(o+n*r/2,(t-i)/2,.8*n,i)})),i.value>0){const e=i.value/c.value;l.fillStyle=a.progressColor,u.value.forEach(((a,i)=>{const c=i*n;if(c/o<=e){const e=a*t;l.fillRect(c+n*r/2,(t-e)/2,.8*n,e)}}))}},C=()=>{o.value&&(t.value=l.value.createBufferSource(),t.value.buffer=o.value,t.value.connect(l.value.destination),r.value=l.value.currentTime-i.value,t.value.start(0,i.value),n.value=!0,a.updateIsplaying&&a.updateIsplaying(n.value),k())},w=()=>{t.value&&(t.value.stop(),t.value=null),v.value&&cancelAnimationFrame(v.value),n.value=!1,a.updateIsplaying&&a.updateIsplaying(n.value)},k=()=>{v.value=requestAnimationFrame(k),n.value&&(i.value=l.value.currentTime-r.value,i.value>=c.value&&(w(),i.value=0),m.value=i.value/c.value*s.value,h())},E=()=>{y()},N=()=>{t.value&&t.value.stop(),v.value&&cancelAnimationFrame(v.value),l.value&&l.value.close()};return e.onMounted((async()=>{await p(),y(),window.addEventListener("resize",E)})),e.onBeforeUnmount((()=>{N(),window.removeEventListener("resize",E)})),e.watch((()=>a.audioUrl),(async()=>{N(),await p()}),{deep:!0}),{isPlaying:n,currentTime:i,duration:c,progressPosition:m,waveformCanvas:f,togglePlayPause:()=>{n.value?w():C()},handleCanvasClick:e=>{const a=e.target.getBoundingClientRect(),l=(e.clientX-a.left)/s.value*c.value;i.value=l,n.value?(w(),C()):(m.value=i.value/c.value*s.value,h())},handleMouseMove:e=>{},formatTime:e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}}};const l={class:"waveform-container"},o={class:"controls"},t={class:"time"};a.render=function(a,n,r,i,c,u){return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",null,[r.showPlayButton?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-success",onClick:n[0]||(n[0]=(...e)=>i.togglePlayPause&&i.togglePlayPause(...e))},[e.createElementVNode("span",{class:e.normalizeClass(i.isPlaying?"icon-pause":"icon-play")},null,2),e.createTextVNode(" "+e.toDisplayString(i.isPlaying?"Pause Recording":"Play Recording"),1)])):e.createCommentVNode("v-if",!0)]),e.createElementVNode("div",l,[e.createElementVNode("canvas",{ref:"waveformCanvas",class:"waveform",onClick:n[1]||(n[1]=(...e)=>i.handleCanvasClick&&i.handleCanvasClick(...e)),onMousemove:n[2]||(n[2]=(...e)=>i.handleMouseMove&&i.handleMouseMove(...e))},null,544),i.isPlaying||i.currentTime>0?(e.openBlock(),e.createElementBlock("div",{key:0,class:"progress-bar",style:e.normalizeStyle({left:i.progressPosition+"px"})},null,4)):e.createCommentVNode("v-if",!0)]),e.createElementVNode("div",o,[e.createElementVNode("span",t,e.toDisplayString(i.formatTime(i.currentTime))+" / "+e.toDisplayString(i.formatTime(i.duration)),1)])],64)},a.__file="src/components/CustomWaveForm.vue";var n={name:"AudioRecorder",components:{CustomWaveForm:a},props:{showSaveButton:{type:Boolean,required:!1,default:!1}},setup(a,{emit:l}){const o=e.ref(null),t=e.ref(!1);e.ref(null);const n=e.ref(0),r=e.ref(null),i=e.ref(!0),c=e.ref(!1),u=e.ref(null),s=e.ref(null),d=e.ref(!1),v=e.ref(!1),m=e.ref(0),f=e.ref([]),p=e.ref(null),g="#4F4A85",y="#f5f5f5",h=.2,C=e.ref(null);e.ref(null);const w=e.ref(null),k=e.ref(null),E=e.ref(null),N=e.ref(null),V=e.ref(null),S=e.ref(null),b=async e=>{u.value=null,k.value=new(window.AudioContext||window.webkitAudioContext),E.value=k.value.createAnalyser(),V.value=k.value.createMediaStreamSource(e),V.value.connect(E.value),E.value.fftSize=2048;const l=E.value.frequencyBinCount;N.value=new Uint8Array(l);const o=["audio/webm","audio/mp4;codecs=aac","audio/webm;codecs=opus","audio/ogg;codecs=opus","audio/wav","audio/ogg"].find((e=>MediaRecorder.isTypeSupported(e)))||"";w.value=new MediaRecorder(e,{mimeType:o}),f.value=[],w.value.ondataavailable=e=>{f.value.push(e.data)},w.value.onstop=()=>{p.value=new Blob(f.value,{type:"audio/webm"}),u.value=URL.createObjectURL(p.value),V.value.disconnect(),cancelAnimationFrame(S.value),A(!a.showSaveButton)},w.value.start(),c.value=!0,P(),F()},B=async()=>{if(t.value=!1,c.value)R();else try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});await b(e)}catch(e){s.value="Error accessing microphone: "+e.message}l("update-save-button",!!u.value)},R=()=>{w.value&&c.value&&(w.value.stop(),c.value=!1,D())},A=async(e=!0)=>{if(p.value){s.value=null;try{e&&l("recording-complete",{file:p.value})}catch(e){s.value=e.message,console.error("Save error:",e)}finally{r.value&&clearInterval(r.value),m.value=0}}},P=()=>{n.value=300,r.value=setInterval((()=>{n.value--,n.value<1&&R()}),1e3)},D=()=>{r.value&&clearInterval(r.value)},F=()=>{const e=C.value;if(!e)return;const a=e.getContext("2d"),l=e.width,o=e.height,t=()=>{S.value=requestAnimationFrame(t),E.value.getByteFrequencyData(N.value),a.fillStyle=y,a.fillRect(0,0,l,o);const e=N.value.length,n=l/2/e,r=o/2;for(let t=0;t<e;t++){const e=N.value[t]/255*(o/2),i=l/2-t*n-n,c=l/2+t*n,u=a.createLinearGradient(i,r-e,i,r+e);u.addColorStop(0,g),u.addColorStop(.5,g+"80"),u.addColorStop(1,g);const s=a.createLinearGradient(c,r-e,c,r+e);s.addColorStop(0,g),s.addColorStop(.5,g+"80"),s.addColorStop(1,g),a.fillStyle=u,a.fillRect(i+n*h/2,r-e,.8*n,2*e),a.fillStyle=s,a.fillRect(c+n*h/2,r-e,.8*n,2*e)}};t()};return e.onMounted((async()=>{try{if(C.value){const e=C.value,a=e.getContext("2d");a.fillStyle=y,a.fillRect(0,0,e.width,e.height),a.strokeStyle=g,a.lineWidth=2,a.setLineDash([5,5]);const l=e.height/2;a.beginPath(),a.moveTo(0,l),a.lineTo(e.width,l),a.stroke(),a.setLineDash([])}}catch(e){s.value="Failed to initialize canvas: "+e.message}})),e.onUnmounted((()=>{u.value&&URL.revokeObjectURL(u.value),S.value&&cancelAnimationFrame(S.value),k.value&&k.value.close()})),{childFormRef:o,showEditConfirmationDialog:t,timer:n,isLoaded:i,recording:c,audioUrl:u,error:s,isPlaying:d,converting:v,conversionProgress:m,visualizer:C,openConfirmationDialog:()=>{u.value?t.value=!0:(t.value=!1,B())},toggleRecording:B,handleSave:A,formatTime:e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,updateIsplaying:e=>{d.value=e},playAudio:async()=>{u.value&&await o.value.togglePlayPause()}}}};const r={class:"audio-recorder"},i={key:0,class:"dialog-overlay"},c={class:"dialog-container"},u={class:"dialog-footer"},s={key:1,class:"skeleton"},d={key:2,class:"control-container"},v={class:"control-row"},m={class:"button-group"},f=["disabled"],p={key:0,class:"timer"},g={key:3,class:"dialog-overlay"},y={class:"waveform-container"},h={ref:"visualizer",class:"wave-canvas",width:"690",height:"200"},C={key:5,class:"message error"};n.render=function(a,l,o,t,n,w){const k=e.resolveComponent("custom-wave-form");return e.openBlock(),e.createElementBlock("div",r,[e.createCommentVNode(" Confirmation Dialog "),t.showEditConfirmationDialog?(e.openBlock(),e.createElementBlock("div",i,[e.createElementVNode("div",c,[l[7]||(l[7]=e.createElementVNode("div",{class:"dialog-header"},[e.createElementVNode("h3",null,"Confirm")],-1)),l[8]||(l[8]=e.createElementVNode("div",{class:"dialog-content"},[e.createElementVNode("div",{class:"warning-icon"},"!"),e.createElementVNode("span",null," Are you sure you wish to overwrite your current recording? ")],-1)),e.createElementVNode("div",u,[e.createElementVNode("button",{class:"btn btn-text",onClick:l[0]||(l[0]=e=>t.showEditConfirmationDialog=!1)},l[5]||(l[5]=[e.createElementVNode("span",{class:"icon-close"},null,-1),e.createTextVNode(" No ")])),e.createElementVNode("button",{class:"btn btn-primary",onClick:l[1]||(l[1]=(...e)=>t.toggleRecording&&t.toggleRecording(...e))},l[6]||(l[6]=[e.createElementVNode("span",{class:"icon-check"},null,-1),e.createTextVNode(" Yes ")]))])])])):e.createCommentVNode("v-if",!0),t.isLoaded?e.createCommentVNode("v-if",!0):(e.openBlock(),e.createElementBlock("div",s)),t.isLoaded?(e.openBlock(),e.createElementBlock("div",d,[e.createElementVNode("div",v,[e.createElementVNode("div",m,[t.audioUrl?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn btn-success play-button",onClick:l[2]||(l[2]=(...e)=>t.playAudio&&t.playAudio(...e))},[e.createElementVNode("span",{class:e.normalizeClass(t.isPlaying?"icon-pause":"icon-play")},null,2),e.createTextVNode(" "+e.toDisplayString(t.isPlaying?"Pause Recording":"Play Recording"),1)])):e.createCommentVNode("v-if",!0),e.createElementVNode("button",{class:e.normalizeClass(["btn",t.recording?"btn-danger":"btn-primary"]),onClick:l[3]||(l[3]=(...e)=>t.openConfirmationDialog&&t.openConfirmationDialog(...e))},[e.createElementVNode("span",{class:e.normalizeClass(t.recording?"icon-stop":"icon-microphone")},null,2),e.createTextVNode(" "+e.toDisplayString(t.recording?"Stop Recording":"Start Recording"),1)],2),o.showSaveButton?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-primary",disabled:!t.audioUrl,onClick:l[4]||(l[4]=e=>t.handleSave(!0))},l[9]||(l[9]=[e.createElementVNode("span",{class:"icon-save"},null,-1),e.createTextVNode(" Save Audio ")]),8,f)):e.createCommentVNode("v-if",!0)]),t.audioUrl?e.createCommentVNode("v-if",!0):(e.openBlock(),e.createElementBlock("div",p,[l[10]||(l[10]=e.createElementVNode("span",{class:"clock-icon"},null,-1)),e.createElementVNode("span",null,e.toDisplayString(t.formatTime(t.timer)),1)]))])])):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Converting Dialog "),t.converting?(e.openBlock(),e.createElementBlock("div",g,l[11]||(l[11]=[e.createElementVNode("div",{class:"dialog-container"},[e.createElementVNode("div",{class:"dialog-header"},[e.createElementVNode("h3",null,"Converting Audio")]),e.createElementVNode("div",{class:"conversion-progress"},[e.createElementVNode("div",{class:"progress-bar-indeterminate"})])],-1)]))):e.createCommentVNode("v-if",!0),e.withDirectives(e.createElementVNode("div",y,[e.createElementVNode("canvas",h,null,512)],512),[[e.vShow,t.isLoaded&&!t.audioUrl]]),t.isLoaded&&t.audioUrl?(e.openBlock(),e.createBlock(k,{key:4,ref:"childFormRef","audio-url":t.audioUrl,"update-isplaying":t.updateIsplaying,"show-play-button":!1,"wave-color":"#4F4A85","progress-color":"#383351"},null,8,["audio-url","update-isplaying"])):e.createCommentVNode("v-if",!0),t.error?(e.openBlock(),e.createElementBlock("div",C,e.toDisplayString(t.error),1)):e.createCommentVNode("v-if",!0)])},n.__file="src/components/AudioRecorder.vue";var w={install:e=>{e.component("AudioRecorder",n),e.component("CustomWaveForm",a)}};exports.AudioRecorder=n,exports.CustomWaveForm=a,exports.default=w;
