!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],a):a((e="undefined"!=typeof globalThis?globalThis:e||self).VueAudioRecorder={},e.Vue)}(this,(function(e,a){"use strict";var l={name:"CustomWaveForm",props:{updateIsplaying:{type:Function,required:!1},audioUrl:{type:String,required:!0},showPlayButton:{type:Boolean,default:!0},waveColor:{type:String,default:"#4F4A85"},progressColor:{type:String,default:"#383351"}},setup(e){const l=a.ref(null),o=a.ref(null),t=a.ref(null),n=a.ref(!1),r=a.ref(0),i=a.ref(0),c=a.ref(0),u=a.ref([]),s=a.ref(0),d=a.ref(0),v=a.ref(null),m=a.ref(0),f=a.ref(null),p=async()=>{try{l.value=new(window.AudioContext||window.webkitAudioContext);const a=await fetch(e.audioUrl),t=await a.arrayBuffer();o.value=await l.value.decodeAudioData(t),c.value=o.value.duration,await g()}catch(e){console.error("Error initializing audio:",e)}},g=async()=>{const e=o.value.getChannelData(0),a=Math.floor(e.length/1e3);u.value=[];for(let l=0;l<1e3;l++){const o=a*l;let t=0;for(let l=0;l<a;l++){const a=Math.abs(e[o+l]);a>t&&(t=a)}u.value.push(t)}h()},y=()=>{const e=f.value,a=e.parentElement;s.value=a.clientWidth,d.value=a.clientHeight,e.width=s.value,e.height=d.value,h()},h=()=>{if(!u.value.length||!f.value)return;const a=f.value,l=a.getContext("2d"),o=a.width,t=a.height;l.clearRect(0,0,o,t);const n=o/u.value.length,r=.2;if(l.fillStyle=e.waveColor,u.value.forEach(((e,a)=>{const o=a*n,i=e*t;l.fillRect(o+n*r/2,(t-i)/2,.8*n,i)})),i.value>0){const a=i.value/c.value;l.fillStyle=e.progressColor,u.value.forEach(((e,i)=>{const c=i*n;if(c/o<=a){const a=e*t;l.fillRect(c+n*r/2,(t-a)/2,.8*n,a)}}))}},C=()=>{o.value&&(t.value=l.value.createBufferSource(),t.value.buffer=o.value,t.value.connect(l.value.destination),r.value=l.value.currentTime-i.value,t.value.start(0,i.value),n.value=!0,e.updateIsplaying&&e.updateIsplaying(n.value),k())},w=()=>{t.value&&(t.value.stop(),t.value=null),v.value&&cancelAnimationFrame(v.value),n.value=!1,e.updateIsplaying&&e.updateIsplaying(n.value)},k=()=>{v.value=requestAnimationFrame(k),n.value&&(i.value=l.value.currentTime-r.value,i.value>=c.value&&(w(),i.value=0),m.value=i.value/c.value*s.value,h())},E=()=>{y()},V=()=>{t.value&&t.value.stop(),v.value&&cancelAnimationFrame(v.value),l.value&&l.value.close()};return a.onMounted((async()=>{await p(),y(),window.addEventListener("resize",E)})),a.onBeforeUnmount((()=>{V(),window.removeEventListener("resize",E)})),a.watch((()=>e.audioUrl),(async()=>{V(),await p()}),{deep:!0}),{isPlaying:n,currentTime:i,duration:c,progressPosition:m,waveformCanvas:f,togglePlayPause:()=>{n.value?w():C()},handleCanvasClick:e=>{const a=e.target.getBoundingClientRect(),l=(e.clientX-a.left)/s.value*c.value;i.value=l,n.value?(w(),C()):(m.value=i.value/c.value*s.value,h())},handleMouseMove:e=>{},formatTime:e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}}};const o={class:"waveform-container"},t={class:"controls"},n={class:"time"};l.render=function(e,l,r,i,c,u){return a.openBlock(),a.createElementBlock(a.Fragment,null,[a.createElementVNode("div",null,[r.showPlayButton?(a.openBlock(),a.createElementBlock("button",{key:0,class:"btn btn-success",onClick:l[0]||(l[0]=(...e)=>i.togglePlayPause&&i.togglePlayPause(...e))},[a.createElementVNode("span",{class:a.normalizeClass(i.isPlaying?"icon-pause":"icon-play")},null,2),a.createTextVNode(" "+a.toDisplayString(i.isPlaying?"Pause Recording":"Play Recording"),1)])):a.createCommentVNode("v-if",!0)]),a.createElementVNode("div",o,[a.createElementVNode("canvas",{ref:"waveformCanvas",class:"waveform",onClick:l[1]||(l[1]=(...e)=>i.handleCanvasClick&&i.handleCanvasClick(...e)),onMousemove:l[2]||(l[2]=(...e)=>i.handleMouseMove&&i.handleMouseMove(...e))},null,544),i.isPlaying||i.currentTime>0?(a.openBlock(),a.createElementBlock("div",{key:0,class:"progress-bar",style:a.normalizeStyle({left:i.progressPosition+"px"})},null,4)):a.createCommentVNode("v-if",!0)]),a.createElementVNode("div",t,[a.createElementVNode("span",n,a.toDisplayString(i.formatTime(i.currentTime))+" / "+a.toDisplayString(i.formatTime(i.duration)),1)])],64)},l.__file="src/components/CustomWaveForm.vue";var r={name:"AudioRecorder",components:{CustomWaveForm:l},props:{showSaveButton:{type:Boolean,required:!1,default:!1}},setup(e,{emit:l}){const o=a.ref(null),t=a.ref(!1);a.ref(null);const n=a.ref(0),r=a.ref(null),i=a.ref(!0),c=a.ref(!1),u=a.ref(null),s=a.ref(null),d=a.ref(!1),v=a.ref(!1),m=a.ref(0),f=a.ref([]),p=a.ref(null),g="#4F4A85",y="#f5f5f5",h=.2,C=a.ref(null);a.ref(null);const w=a.ref(null),k=a.ref(null),E=a.ref(null),V=a.ref(null),N=a.ref(null),b=a.ref(null),S=async a=>{u.value=null,k.value=new(window.AudioContext||window.webkitAudioContext),E.value=k.value.createAnalyser(),N.value=k.value.createMediaStreamSource(a),N.value.connect(E.value),E.value.fftSize=2048;const l=E.value.frequencyBinCount;V.value=new Uint8Array(l);const o=["audio/webm","audio/mp4;codecs=aac","audio/webm;codecs=opus","audio/ogg;codecs=opus","audio/wav","audio/ogg"].find((e=>MediaRecorder.isTypeSupported(e)))||"";w.value=new MediaRecorder(a,{mimeType:o}),f.value=[],w.value.ondataavailable=e=>{f.value.push(e.data)},w.value.onstop=()=>{p.value=new Blob(f.value,{type:"audio/webm"}),u.value=URL.createObjectURL(p.value),N.value.disconnect(),cancelAnimationFrame(b.value),A(!e.showSaveButton)},w.value.start(),c.value=!0,P(),T()},B=async()=>{if(t.value=!1,c.value)R();else try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});await S(e)}catch(e){s.value="Error accessing microphone: "+e.message}l("update-save-button",!!u.value)},R=()=>{w.value&&c.value&&(w.value.stop(),c.value=!1,D())},A=async(e=!0)=>{if(p.value){s.value=null;try{e&&l("recording-complete",{file:p.value})}catch(e){s.value=e.message,console.error("Save error:",e)}finally{r.value&&clearInterval(r.value),m.value=0}}},P=()=>{n.value=300,r.value=setInterval((()=>{n.value--,n.value<1&&R()}),1e3)},D=()=>{r.value&&clearInterval(r.value)},T=()=>{const e=C.value;if(!e)return;const a=e.getContext("2d"),l=e.width,o=e.height,t=()=>{b.value=requestAnimationFrame(t),E.value.getByteFrequencyData(V.value),a.fillStyle=y,a.fillRect(0,0,l,o);const e=V.value.length,n=l/2/e,r=o/2;for(let t=0;t<e;t++){const e=V.value[t]/255*(o/2),i=l/2-t*n-n,c=l/2+t*n,u=a.createLinearGradient(i,r-e,i,r+e);u.addColorStop(0,g),u.addColorStop(.5,g+"80"),u.addColorStop(1,g);const s=a.createLinearGradient(c,r-e,c,r+e);s.addColorStop(0,g),s.addColorStop(.5,g+"80"),s.addColorStop(1,g),a.fillStyle=u,a.fillRect(i+n*h/2,r-e,.8*n,2*e),a.fillStyle=s,a.fillRect(c+n*h/2,r-e,.8*n,2*e)}};t()};return a.onMounted((async()=>{try{if(C.value){const e=C.value,a=e.getContext("2d");a.fillStyle=y,a.fillRect(0,0,e.width,e.height),a.strokeStyle=g,a.lineWidth=2,a.setLineDash([5,5]);const l=e.height/2;a.beginPath(),a.moveTo(0,l),a.lineTo(e.width,l),a.stroke(),a.setLineDash([])}}catch(e){s.value="Failed to initialize canvas: "+e.message}})),a.onUnmounted((()=>{u.value&&URL.revokeObjectURL(u.value),b.value&&cancelAnimationFrame(b.value),k.value&&k.value.close()})),{childFormRef:o,showEditConfirmationDialog:t,timer:n,isLoaded:i,recording:c,audioUrl:u,error:s,isPlaying:d,converting:v,conversionProgress:m,visualizer:C,openConfirmationDialog:()=>{u.value?t.value=!0:(t.value=!1,B())},toggleRecording:B,handleSave:A,formatTime:e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,updateIsplaying:e=>{d.value=e},playAudio:async()=>{u.value&&await o.value.togglePlayPause()}}}};const i={class:"audio-recorder"},c={key:0,class:"dialog-overlay"},u={class:"dialog-container"},s={class:"dialog-footer"},d={key:1,class:"skeleton"},v={key:2,class:"control-container"},m={class:"control-row"},f={class:"button-group"},p=["disabled"],g={key:0,class:"timer"},y={key:3,class:"dialog-overlay"},h={class:"waveform-container"},C={ref:"visualizer",class:"wave-canvas",width:"690",height:"200"},w={key:5,class:"message error"};r.render=function(e,l,o,t,n,r){const k=a.resolveComponent("custom-wave-form");return a.openBlock(),a.createElementBlock("div",i,[a.createCommentVNode(" Confirmation Dialog "),t.showEditConfirmationDialog?(a.openBlock(),a.createElementBlock("div",c,[a.createElementVNode("div",u,[l[7]||(l[7]=a.createElementVNode("div",{class:"dialog-header"},[a.createElementVNode("h3",null,"Confirm")],-1)),l[8]||(l[8]=a.createElementVNode("div",{class:"dialog-content"},[a.createElementVNode("div",{class:"warning-icon"},"!"),a.createElementVNode("span",null," Are you sure you wish to overwrite your current recording? ")],-1)),a.createElementVNode("div",s,[a.createElementVNode("button",{class:"btn btn-text",onClick:l[0]||(l[0]=e=>t.showEditConfirmationDialog=!1)},l[5]||(l[5]=[a.createElementVNode("span",{class:"icon-close"},null,-1),a.createTextVNode(" No ")])),a.createElementVNode("button",{class:"btn btn-primary",onClick:l[1]||(l[1]=(...e)=>t.toggleRecording&&t.toggleRecording(...e))},l[6]||(l[6]=[a.createElementVNode("span",{class:"icon-check"},null,-1),a.createTextVNode(" Yes ")]))])])])):a.createCommentVNode("v-if",!0),t.isLoaded?a.createCommentVNode("v-if",!0):(a.openBlock(),a.createElementBlock("div",d)),t.isLoaded?(a.openBlock(),a.createElementBlock("div",v,[a.createElementVNode("div",m,[a.createElementVNode("div",f,[t.audioUrl?(a.openBlock(),a.createElementBlock("button",{key:0,class:"btn btn-success play-button",onClick:l[2]||(l[2]=(...e)=>t.playAudio&&t.playAudio(...e))},[a.createElementVNode("span",{class:a.normalizeClass(t.isPlaying?"icon-pause":"icon-play")},null,2),a.createTextVNode(" "+a.toDisplayString(t.isPlaying?"Pause Recording":"Play Recording"),1)])):a.createCommentVNode("v-if",!0),a.createElementVNode("button",{class:a.normalizeClass(["btn",t.recording?"btn-danger":"btn-primary"]),onClick:l[3]||(l[3]=(...e)=>t.openConfirmationDialog&&t.openConfirmationDialog(...e))},[a.createElementVNode("span",{class:a.normalizeClass(t.recording?"icon-stop":"icon-microphone")},null,2),a.createTextVNode(" "+a.toDisplayString(t.recording?"Stop Recording":"Start Recording"),1)],2),o.showSaveButton?(a.openBlock(),a.createElementBlock("button",{key:1,class:"btn btn-primary",disabled:!t.audioUrl,onClick:l[4]||(l[4]=e=>t.handleSave(!0))},l[9]||(l[9]=[a.createElementVNode("span",{class:"icon-save"},null,-1),a.createTextVNode(" Save Audio ")]),8,p)):a.createCommentVNode("v-if",!0)]),t.audioUrl?a.createCommentVNode("v-if",!0):(a.openBlock(),a.createElementBlock("div",g,[l[10]||(l[10]=a.createElementVNode("span",{class:"clock-icon"},null,-1)),a.createElementVNode("span",null,a.toDisplayString(t.formatTime(t.timer)),1)]))])])):a.createCommentVNode("v-if",!0),a.createCommentVNode(" Converting Dialog "),t.converting?(a.openBlock(),a.createElementBlock("div",y,l[11]||(l[11]=[a.createElementVNode("div",{class:"dialog-container"},[a.createElementVNode("div",{class:"dialog-header"},[a.createElementVNode("h3",null,"Converting Audio")]),a.createElementVNode("div",{class:"conversion-progress"},[a.createElementVNode("div",{class:"progress-bar-indeterminate"})])],-1)]))):a.createCommentVNode("v-if",!0),a.withDirectives(a.createElementVNode("div",h,[a.createElementVNode("canvas",C,null,512)],512),[[a.vShow,t.isLoaded&&!t.audioUrl]]),t.isLoaded&&t.audioUrl?(a.openBlock(),a.createBlock(k,{key:4,ref:"childFormRef","audio-url":t.audioUrl,"update-isplaying":t.updateIsplaying,"show-play-button":!1,"wave-color":"#4F4A85","progress-color":"#383351"},null,8,["audio-url","update-isplaying"])):a.createCommentVNode("v-if",!0),t.error?(a.openBlock(),a.createElementBlock("div",w,a.toDisplayString(t.error),1)):a.createCommentVNode("v-if",!0)])},r.__file="src/components/AudioRecorder.vue";var k={install:e=>{e.component("AudioRecorder",r),e.component("CustomWaveForm",l)}};e.AudioRecorder=r,e.CustomWaveForm=l,e.default=k,Object.defineProperty(e,"__esModule",{value:!0})}));
